<ng-container *ngIf="(package$ | async) as npmPackage">
    <div id="package-header" class="row">
        <div>
            <fa-icon [icon]="['fas', 'cube']" size="10x"></fa-icon>
        </div>
        <div class="col">
            <h1>{{ npmPackage.name }}</h1>
            <h6>{{ npmPackage.author.name }}</h6>
            <p>{{ npmPackage.description }}</p>
            <form [formGroup]="packageInstallForm" (ngSubmit)="installPackage()">
                <div class="d-flex">
                    <select formControlName="version" class="form-control">
                        <option *ngFor="let version of npmPackage.versions.reverse()" [ngValue]="version.version">
                            {{ version.version }}<ng-container *ngIf="version.distTags.length" > ({{ version.distTags.join(', ') }})</ng-container>
                        </option>
                    </select>
                    <div *ngIf="selectedVersion$ | async as selectedVersion" class="input-group-append">
                        <button type="submit" class="btn btn-primary" [class.installing]="installingPackage$ | async" [disabled]="installingPackage$ | async">
                            <div class="spinner-border spinner-border-sm text-light" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                            <ng-container *ngIf="installedVersion$ | async as installedVersion; else installText">
                                <ng-container *ngIf="selectedVersion | equals:installedVersion; then installText"></ng-container>
                                <ng-container *ngIf="selectedVersion | isGreaterThan:installedVersion">Upgrade</ng-container>
                                <ng-container *ngIf="selectedVersion | isLessThan:installedVersion">Downgrade</ng-container>
                            </ng-container>
                            <ng-template #installText>Install</ng-template>
                        </button>
                    </div>
                    <div *ngIf="installedVersion$ | async as installedVersion" class="input-group-append installed-message">
                        <fa-icon [icon]="['fas', 'check-circle']"></fa-icon> 
                        Installed 
                        <b class="ml-1">({{ installedVersion.raw }})</b>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <ngb-tabset>
        <ngb-tab title="Readme">
            <ng-template ngbTabContent>
                <div class="row">
                    <div class="col">
                        <markdown *ngIf="npmPackage.readme" ngPreserveWhitespaces [data]="npmPackage.readme"></markdown>
                        <div *ngIf="!npmPackage.readme" class="alert alert-info">
                            <fa-icon [icon]="['fas', 'info-circle']"></fa-icon> This package does not have a readme.
                        </div>
                    </div>
                </div>
            </ng-template>
        </ngb-tab>
        <ngb-tab title="Versions">
            <ng-template ngbTabContent>
                <div class="row">
                    <div class="col">
                        <p>Versions</p>
                    </div>
                </div>
            </ng-template>
        </ngb-tab>
    </ngb-tabset>
</ng-container>